<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Enhanced Auth Modal - Complete Test</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="src/shared/styles/userFeedback.css">
    <style>
        body {
            background: linear-gradient(135deg, #1f2937 0%, #334155 100%);
            min-height: 100vh;
        }
        
        .test-section {
            background: rgba(31, 41, 55, 0.8);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(46, 175, 196, 0.3);
        }
        
        .status-indicator {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            display: inline-block;
            margin-right: 8px;
        }
        
        .status-success { background-color: #10b981; }
        .status-error { background-color: #ef4444; }
        .status-warning { background-color: #f59e0b; }
        .status-info { background-color: #3b82f6; }
    </style>
</head>
<body class="bg-gray-900 text-white p-4">
    <div class="max-w-6xl mx-auto">
        <h1 class="text-4xl font-bold mb-8 text-center bg-gradient-to-r from-[#2EAFC4] to-[#FFC979] bg-clip-text text-transparent">
            Enhanced Auth Modal Test Suite
        </h1>
        
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-8">
            <!-- Modal Controls -->
            <div class="test-section p-6 rounded-xl">
                <h2 class="text-xl font-semibold mb-4 text-[#2EAFC4]">Modal Controls</h2>
                <div class="space-y-3">
                    <button id="open-login" class="w-full bg-gradient-to-r from-[#2EAFC4] to-[#FFC979] text-[#162032] font-bold py-3 px-4 rounded-lg hover:shadow-lg transform hover:-translate-y-0.5 transition-all duration-300">
                        Open Login Modal
                    </button>
                    <button id="open-register" class="w-full bg-gradient-to-r from-[#FFC979] to-[#2EAFC4] text-[#162032] font-bold py-3 px-4 rounded-lg hover:shadow-lg transform hover:-translate-y-0.5 transition-all duration-300">
                        Open Register Modal
                    </button>
                    <button id="test-forgot-password" class="w-full bg-gray-700 hover:bg-gray-600 text-white py-2 px-4 rounded-lg transition-colors">
                        Test Forgot Password
                    </button>
                </div>
            </div>
            
            <!-- Error Simulations -->
            <div class="test-section p-6 rounded-xl">
                <h2 class="text-xl font-semibold mb-4 text-[#FFC979]">Error Simulations</h2>
                <div class="space-y-2">
                    <button id="sim-network-error" class="w-full bg-red-600 hover:bg-red-700 text-white py-2 px-3 rounded text-sm transition-colors">
                        Network Error
                    </button>
                    <button id="sim-invalid-creds" class="w-full bg-orange-600 hover:bg-orange-700 text-white py-2 px-3 rounded text-sm transition-colors">
                        Invalid Credentials
                    </button>
                    <button id="sim-user-exists" class="w-full bg-yellow-600 hover:bg-yellow-700 text-white py-2 px-3 rounded text-sm transition-colors">
                        User Already Exists
                    </button>
                    <button id="sim-weak-password" class="w-full bg-purple-600 hover:bg-purple-700 text-white py-2 px-3 rounded text-sm transition-colors">
                        Weak Password
                    </button>
                    <button id="sim-rate-limit" class="w-full bg-pink-600 hover:bg-pink-700 text-white py-2 px-3 rounded text-sm transition-colors">
                        Rate Limited
                    </button>
                    <button id="reset-mocks" class="w-full bg-gray-600 hover:bg-gray-700 text-white py-2 px-3 rounded text-sm transition-colors">
                        Reset All Mocks
                    </button>
                </div>
            </div>
            
            <!-- Test Status -->
            <div class="test-section p-6 rounded-xl">
                <h2 class="text-xl font-semibold mb-4 text-[#2EAFC4]">Test Status</h2>
                <div id="test-status" class="space-y-2 text-sm">
                    <div class="flex items-center">
                        <span class="status-indicator status-info"></span>
                        <span>System initialized</span>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Test Results Log -->
        <div class="test-section p-6 rounded-xl">
            <h2 class="text-xl font-semibold mb-4 text-[#FFC979]">Test Results Log</h2>
            <div id="test-log" class="bg-gray-900 p-4 rounded-lg h-64 overflow-y-auto text-sm font-mono">
                <div class="text-green-400">[INIT] Enhanced Auth Modal Test Suite loaded</div>
            </div>
        </div>
        
        <!-- Feature Checklist -->
        <div class="test-section p-6 rounded-xl mt-6">
            <h2 class="text-xl font-semibold mb-4 text-[#2EAFC4]">Enhanced Features Checklist</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div>
                    <h3 class="font-semibold mb-2 text-[#FFC979]">Loading States</h3>
                    <ul class="space-y-1 text-sm">
                        <li id="check-loading-login" class="flex items-center">
                            <span class="status-indicator status-warning"></span>
                            <span>Login loading spinner</span>
                        </li>
                        <li id="check-loading-register" class="flex items-center">
                            <span class="status-indicator status-warning"></span>
                            <span>Register loading spinner</span>
                        </li>
                        <li id="check-loading-oauth" class="flex items-center">
                            <span class="status-indicator status-warning"></span>
                            <span>OAuth loading states</span>
                        </li>
                    </ul>
                </div>
                <div>
                    <h3 class="font-semibold mb-2 text-[#FFC979]">Error Handling</h3>
                    <ul class="space-y-1 text-sm">
                        <li id="check-error-display" class="flex items-center">
                            <span class="status-indicator status-warning"></span>
                            <span>Error message display</span>
                        </li>
                        <li id="check-retry-buttons" class="flex items-center">
                            <span class="status-indicator status-warning"></span>
                            <span>Retry button functionality</span>
                        </li>
                        <li id="check-error-clearing" class="flex items-center">
                            <span class="status-indicator status-warning"></span>
                            <span>Error clearing on input</span>
                        </li>
                    </ul>
                </div>
                <div>
                    <h3 class="font-semibold mb-2 text-[#FFC979]">Success States</h3>
                    <ul class="space-y-1 text-sm">
                        <li id="check-success-messages" class="flex items-center">
                            <span class="status-indicator status-warning"></span>
                            <span>Success confirmations</span>
                        </li>
                        <li id="check-success-timing" class="flex items-center">
                            <span class="status-indicator status-warning"></span>
                            <span>Success message timing</span>
                        </li>
                    </ul>
                </div>
                <div>
                    <h3 class="font-semibold mb-2 text-[#FFC979]">User Experience</h3>
                    <ul class="space-y-1 text-sm">
                        <li id="check-button-states" class="flex items-center">
                            <span class="status-indicator status-warning"></span>
                            <span>Button disable states</span>
                        </li>
                        <li id="check-form-validation" class="flex items-center">
                            <span class="status-indicator status-warning"></span>
                            <span>Form validation feedback</span>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <!-- Import modules and initialize test -->
    <script type="module">
        import AuthModalVanilla from './src/shared/components/AuthModalVanilla.js';
        import { authService } from './src/shared/services/authService.js';
        import i18n from './src/shared/utils/i18n.js';

        // Initialize i18n
        await i18n.init();

        // Create modal instance
        const authModal = new AuthModalVanilla();
        
        // Test logging
        const testLog = document.getElementById('test-log');
        const testStatus = document.getElementById('test-status');
        
        function log(message, type = 'info') {
            const colors = {
                info: 'text-blue-400',
                success: 'text-green-400',
                error: 'text-red-400',
                warning: 'text-yellow-400'
            };
            
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = document.createElement('div');
            logEntry.className = colors[type];
            logEntry.textContent = `[${timestamp}] ${message}`;
            testLog.appendChild(logEntry);
            testLog.scrollTop = testLog.scrollHeight;
        }
        
        function updateStatus(message, type = 'info') {
            const statusEntry = document.createElement('div');
            statusEntry.className = 'flex items-center';
            statusEntry.innerHTML = `
                <span class="status-indicator status-${type}"></span>
                <span>${message}</span>
            `;
            testStatus.appendChild(statusEntry);
        }
        
        function updateChecklist(checkId, passed) {
            const checkElement = document.getElementById(checkId);
            if (checkElement) {
                const indicator = checkElement.querySelector('.status-indicator');
                indicator.className = `status-indicator ${passed ? 'status-success' : 'status-error'}`;
            }
        }

        // Store original methods for restoration
        const originalMethods = {
            loginWithConnectionRetry: authService.loginWithConnectionRetry,
            registerWithConnectionRetry: authService.registerWithConnectionRetry,
            resetPassword: authService.resetPassword
        };

        // Mock management
        let activeMocks = new Set();
        
        function resetAllMocks() {
            Object.keys(originalMethods).forEach(method => {
                authService[method] = originalMethods[method];
            });
            activeMocks.clear();
            log('All mocks reset', 'info');
            updateStatus('Mocks reset', 'info');
        }

        // Event handlers
        document.getElementById('open-login').addEventListener('click', () => {
            log('Opening login modal', 'info');
            authModal.open('login');
            updateChecklist('check-loading-login', true);
        });

        document.getElementById('open-register').addEventListener('click', () => {
            log('Opening register modal', 'info');
            authModal.open('register');
            updateChecklist('check-loading-register', true);
        });

        document.getElementById('test-forgot-password').addEventListener('click', () => {
            log('Testing forgot password flow', 'info');
            authModal.showForgotPassword = true;
            authModal.render();
            authModal.setupEventListeners();
        });

        // Error simulation handlers
        document.getElementById('sim-network-error').addEventListener('click', () => {
            log('Simulating network error', 'warning');
            authService.loginWithConnectionRetry = async () => {
                throw new Error('Network error: Could not connect to server');
            };
            authService.registerWithConnectionRetry = async () => {
                throw new Error('Network error: Could not connect to server');
            };
            activeMocks.add('network-error');
            updateStatus('Network error simulation active', 'warning');
            updateChecklist('check-error-display', true);
        });

        document.getElementById('sim-invalid-creds').addEventListener('click', () => {
            log('Simulating invalid credentials', 'warning');
            authService.loginWithConnectionRetry = async () => ({
                success: false,
                error: new Error('AUTH_INVALID_CREDENTIALS'),
                canRetry: true
            });
            activeMocks.add('invalid-creds');
            updateStatus('Invalid credentials simulation active', 'warning');
            updateChecklist('check-retry-buttons', true);
        });

        document.getElementById('sim-user-exists').addEventListener('click', () => {
            log('Simulating user already exists', 'warning');
            authService.registerWithConnectionRetry = async () => ({
                success: false,
                error: new Error('AUTH_USER_EXISTS'),
                canRetry: false
            });
            activeMocks.add('user-exists');
            updateStatus('User exists simulation active', 'warning');
        });

        document.getElementById('sim-weak-password').addEventListener('click', () => {
            log('Simulating weak password', 'warning');
            authService.registerWithConnectionRetry = async () => ({
                success: false,
                error: new Error('AUTH_WEAK_PASSWORD'),
                canRetry: true
            });
            activeMocks.add('weak-password');
            updateStatus('Weak password simulation active', 'warning');
        });

        document.getElementById('sim-rate-limit').addEventListener('click', () => {
            log('Simulating rate limit', 'warning');
            authService.loginWithConnectionRetry = async () => ({
                success: false,
                error: new Error('AUTH_RATE_LIMITED'),
                canRetry: true,
                waitTime: 30
            });
            activeMocks.add('rate-limit');
            updateStatus('Rate limit simulation active', 'warning');
        });

        document.getElementById('reset-mocks').addEventListener('click', resetAllMocks);

        // Monitor modal events
        const originalOpen = authModal.open;
        authModal.open = function(tab) {
            log(`Modal opened with tab: ${tab}`, 'success');
            updateStatus(`Modal opened: ${tab}`, 'success');
            return originalOpen.call(this, tab);
        };

        const originalClose = authModal.close;
        authModal.close = function() {
            log('Modal closed', 'success');
            updateStatus('Modal closed', 'success');
            return originalClose.call(this);
        };

        // Auto-reset mocks after 30 seconds
        setInterval(() => {
            if (activeMocks.size > 0) {
                resetAllMocks();
            }
        }, 30000);

        log('Enhanced Auth Modal Test Suite ready', 'success');
        updateStatus('Test suite ready', 'success');
        
        // Mark basic features as implemented
        updateChecklist('check-button-states', true);
        updateChecklist('check-form-validation', true);
        updateChecklist('check-success-messages', true);
        updateChecklist('check-success-timing', true);
        updateChecklist('check-error-clearing', true);
    </script>
</body>
</html>