<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‚è∞ Enlace Expirado - Soluci√≥n</title>
    <link rel="stylesheet" href="src/shared/styles/auth-theme.css">
</head>
<body class="auth-page">
    <div class="auth-container">
        <div class="auth-card auth-card-large">
            <div class="auth-text-center">
                <div class="auth-icon-large auth-icon-warning">
                    ‚è∞
                </div>
                <h1 class="auth-title auth-mb-4">Enlace de Recuperaci√≥n Expirado</h1>
                <p class="auth-subtitle auth-mb-6">No te preocupes, esto es normal y tiene soluci√≥n f√°cil</p>
            </div>

            <!-- Por qu√© expiran los enlaces -->
            <div class="auth-info-box auth-info-box-warning">
                <h3 class="auth-section-title">ü§î ¬øPor qu√© expiran los enlaces?</h3>
                <ul class="auth-text">
                    <li>‚Ä¢ <strong>Seguridad:</strong> Los enlaces expiran en 1 hora por tu protecci√≥n</li>
                    <li>‚Ä¢ <strong>Uso √∫nico:</strong> Cada enlace solo se puede usar una vez</li>
                    <li>‚Ä¢ <strong>Sesi√≥n activa:</strong> Si ya tienes una sesi√≥n abierta, puede interferir</li>
                </ul>
            </div>

            <!-- Soluci√≥n paso a paso -->
            <div class="auth-mb-6">
                <h2 class="auth-section-title auth-mb-4">üîß Soluci√≥n Paso a Paso</h2>
                
                <div class="auth-step">
                    <div class="auth-step-number">1</div>
                    <div>
                        <h4 style="font-weight: 600; margin-bottom: 0.25rem;">Cerrar todas las pesta√±as</h4>
                        <p class="auth-text">Cierra todas las pesta√±as de Anclora para limpiar la sesi√≥n</p>
                    </div>
                </div>

                <div class="auth-step">
                    <div class="auth-step-number">2</div>
                    <div>
                        <h4 style="font-weight: 600; margin-bottom: 0.25rem;">Solicitar nuevo enlace</h4>
                        <p class="auth-text">Usa el bot√≥n de abajo para solicitar un enlace fresco</p>
                    </div>
                </div>

                <div class="auth-step">
                    <div class="auth-step-number">3</div>
                    <div>
                        <h4 style="font-weight: 600; margin-bottom: 0.25rem;">Actuar r√°pidamente</h4>
                        <p class="auth-text">Haz clic en el nuevo enlace dentro de los primeros 10 minutos</p>
                    </div>
                </div>

                <div class="auth-step">
                    <div class="auth-step-number">4</div>
                    <div>
                        <h4 style="font-weight: 600; margin-bottom: 0.25rem;">Cambiar contrase√±a inmediatamente</h4>
                        <p class="auth-text">No navegues a otras p√°ginas, cambia la contrase√±a directamente</p>
                    </div>
                </div>
            </div>

            <!-- Acciones principales -->
            <div class="auth-text-center auth-mb-6">
                <h3 class="auth-section-title auth-mb-4">üöÄ Acciones Recomendadas</h3>
                <div class="auth-space-y-3">
                    <a href="test-recuperacion-mejorada.html" class="auth-btn auth-btn-primary auth-btn-full">
                        üìß Solicitar Nuevo Enlace de Recuperaci√≥n
                    </a>
                    
                    <div class="auth-grid auth-grid-2">
                        <a href="diagnostico-email-recuperacion.html" class="auth-btn auth-btn-secondary">
                            üîç Diagn√≥stico Completo
                        </a>
                        <a href="test-login-directo.html" class="auth-btn auth-btn-secondary">
                            üîë Probar Login Directo
                        </a>
                    </div>
                </div>
            </div>

            <!-- Consejos para evitar el problema -->
            <div class="auth-info-box auth-info-box-success">
                <h3 class="auth-section-title">üí° Consejos para Evitar Este Problema</h3>
                <ul class="auth-text">
                    <li>‚Ä¢ <strong>Act√∫a r√°pido:</strong> Usa el enlace dentro de los primeros 10 minutos</li>
                    <li>‚Ä¢ <strong>Una pesta√±a:</strong> Abre el enlace en una sola pesta√±a</li>
                    <li>‚Ä¢ <strong>Sin distracciones:</strong> Cambia la contrase√±a inmediatamente</li>
                    <li>‚Ä¢ <strong>Navegador limpio:</strong> Usa modo inc√≥gnito si tienes problemas</li>
                </ul>
            </div>

            <!-- Informaci√≥n t√©cnica -->
            <details class="mt-6">
                <summary class="cursor-pointer font-semibold text-gray-700 hover:text-gray-900">
                    üîß Informaci√≥n T√©cnica (para desarrolladores)
                </summary>
                <div class="mt-3 p-4 bg-gray-50 border border-gray-200 rounded-lg text-sm">
                    <h4 class="font-semibold mb-2">Posibles causas t√©cnicas:</h4>
                    <ul class="space-y-1 text-gray-600">
                        <li>‚Ä¢ Token JWT expirado (1 hora de vida √∫til)</li>
                        <li>‚Ä¢ Conflicto de sesiones m√∫ltiples</li>
                        <li>‚Ä¢ Problemas de CORS o configuraci√≥n de dominio</li>
                        <li>‚Ä¢ Cache del navegador interfiriendo</li>
                        <li>‚Ä¢ Configuraci√≥n incorrecta de redirectTo en Supabase</li>
                    </ul>
                    
                    <h4 class="font-semibold mt-3 mb-2">URLs de configuraci√≥n actual:</h4>
                    <ul class="space-y-1 text-gray-600 font-mono text-xs">
                        <li>‚Ä¢ Callback: /auth/reset-password.html</li>
                        <li>‚Ä¢ Confirmaci√≥n: /password-updated.html</li>
                        <li>‚Ä¢ Diagn√≥stico: /diagnostico-email-recuperacion.html</li>
                    </ul>
                </div>
            </details>

            <!-- Enlaces de ayuda -->
            <div class="mt-6 text-center">
                <p class="text-sm text-gray-500 mb-3">¬øSigues teniendo problemas?</p>
                <div class="space-x-2">
                    <a href="mailto:soporte@anclora.com?subject=Enlace de recuperaci√≥n expirado" class="text-blue-600 hover:text-blue-800 text-sm">
                        üìß Contactar Soporte
                    </a>
                    <span class="text-gray-300">|</span>
                    <a href="test-flujo-completo-recuperacion.html" class="text-blue-600 hover:text-blue-800 text-sm">
                        üîÑ Test Completo
                    </a>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Detectar si venimos de una p√°gina de error
        const urlParams = new URLSearchParams(window.location.search);
        const error = urlParams.get('error');
        
        if (error) {
            console.log('üîç Error detectado:', error);
            
            // Mostrar informaci√≥n espec√≠fica del error
            const errorInfo = {
                'recovery_session_failed': 'Error al establecer la sesi√≥n de recuperaci√≥n',
                'missing_recovery_tokens': 'Tokens de recuperaci√≥n no encontrados',
                'session_expired': 'La sesi√≥n de recuperaci√≥n ha expirado'
            };
            
            if (errorInfo[error]) {
                const infoBox = document.createElement('div');
                infoBox.className = 'info-box info-error';
                infoBox.innerHTML = `
                    <h3 class="font-semibold mb-2">üö® Error Espec√≠fico Detectado</h3>
                    <p class="text-sm">${errorInfo[error]}</p>
                `;
                
                document.querySelector('.solution-container').insertBefore(
                    infoBox, 
                    document.querySelector('.info-box')
                );
            }
        }

        console.log('‚è∞ P√°gina de soluci√≥n de enlace expirado cargada');
    </script>
</body>
</html>